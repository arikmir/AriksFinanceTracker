<div class="income-container">
  <div class="page-header">
    <h1>Income</h1>
    <p>Track and manage your earnings</p>
  </div>

  <div class="content-grid">
    <!-- Quick Stats -->
    <div class="stats-row">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="stat-info">
            <h3>${{ totalIncome | number:'1.0-0' }}</h3>
            <p>This Month</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>account_balance_wallet</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ incomeCount }}</h3>
            <p>Transactions</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>work</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ primarySource }}</h3>
            <p>Primary Source</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Add Income Form -->
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>{{ editingIncome ? 'edit' : 'add_circle' }}</mat-icon>
          {{ editingIncome ? 'Edit Income' : 'Add New Income' }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form class="income-form" #incomeForm="ngForm" (ngSubmit)="savePrimaryIncome()">
          <div class="form-grid">
            <mat-form-field appearance="fill">
              <mat-label>Date</mat-label>
              <input matInput [matDatepicker]="picker" [(ngModel)]="incomeData.date" name="date" required>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Amount</mat-label>
              <input matInput type="number" [(ngModel)]="incomeData.amount" name="amount"
                     placeholder="0.00">
              <span matPrefix>$&nbsp;</span>
              <mat-error *ngIf="incomeForm.controls['amount']?.invalid">
                Please enter a valid amount
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Source</mat-label>
              <mat-select [(ngModel)]="incomeData.source" name="source" required>
                <mat-option value="Salary">
                  <mat-icon>work</mat-icon>
                  Salary
                </mat-option>
                <mat-option value="Freelance">
                  <mat-icon>laptop_mac</mat-icon>
                  Freelance
                </mat-option>
                <mat-option value="Investment">
                  <mat-icon>trending_up</mat-icon>
                  Investment
                </mat-option>
                <mat-option value="Bonus">
                  <mat-icon>card_giftcard</mat-icon>
                  Bonus
                </mat-option>
                <mat-option value="Other">
                  <mat-icon>more_horiz</mat-icon>
                  Other
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Notes</mat-label>
            <textarea matInput [(ngModel)]="incomeData.notes" name="notes"
                      rows="2" placeholder="Add any additional details..."></textarea>
          </mat-form-field>

          <mat-divider></mat-divider>

          <div class="form-actions">
            <button mat-stroked-button type="button" (click)="resetForm()" [disabled]="isLoading">
              <mat-icon>clear</mat-icon>
              Clear
            </button>
            <button mat-raised-button color="primary" type="submit"
                    [disabled]="!incomeForm.valid || isLoading">
              <mat-icon>{{ isLoading ? 'hourglass_empty' : 'save' }}</mat-icon>
              {{ isLoading ? 'Saving...' : (editingIncome ? 'Update Income' : 'Save Income') }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Recent Income List -->
    <mat-card class="list-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>history</mat-icon>
          Recent Income
        </mat-card-title>
        <div class="header-actions">
          <button mat-icon-button (click)="loadIncomeHistory()">
            <mat-icon>refresh</mat-icon>
          </button>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="income-list" *ngIf="recentIncomes.length > 0; else noIncome">
          <div class="income-item" *ngFor="let income of recentIncomes">
            <div class="income-icon">
              <mat-icon>{{ getSourceIcon(income.source) }}</mat-icon>
            </div>
            <div class="income-details">
              <h4>{{ income.source }}</h4>
              <p>{{ income.date | date:'MMM d, y' }}</p>
              <small *ngIf="income.notes">{{ income.notes }}</small>
            </div>
            <div class="income-amount">
              <span class="amount">${{ income.amount | number:'1.2-2' }}</span>
              <div class="item-actions">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="editIncome(income)">
                    <mat-icon>edit</mat-icon>
                    <span>Edit</span>
                  </button>
                  <button mat-menu-item (click)="deleteIncome(income)">
                    <mat-icon>delete</mat-icon>
                    <span>Delete</span>
                  </button>
                </mat-menu>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noIncome>
          <div class="empty-state">
            <mat-icon>inbox</mat-icon>
            <h3>No income recorded yet</h3>
            <p>Start by adding your first income entry above</p>
          </div>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Success/Error Messages -->
  <div class="snackbar-container" *ngIf="feedbackMessage">
    <mat-card class="snackbar" [class.success]="feedbackType === 'success'" [class.error]="feedbackType === 'error'">
      <mat-icon>{{ feedbackType === 'success' ? 'check_circle' : 'error' }}</mat-icon>
      <span>{{ feedbackMessage }}</span>
    </mat-card>
  </div>
</div>
